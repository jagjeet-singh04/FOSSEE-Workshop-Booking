{% extends 'workshop_app/base.html' %}

{% block title %}
 Workshop  Statistics
{% endblock %}


{% block extra %}

    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
	<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="{{URL_ROOT}}/static/workshop_app/js/bootstrap-3.3.7.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
 	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
  	<!-- For Charts -->

	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.bundle.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js"></script>

	<!-- For Google GeoChart India Map -->
	<script type='text/javascript' src='https://www.google.com/jsapi'></script>

</script>
{% block extra %}
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
	<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
	<style>
		.stats-toggle {
			display: flex;
			gap: 1rem;
			align-items: center;
			margin-bottom: 2rem;
		}
		.toggle-btn {
			border: none;
			background: #e9ecef;
			color: #333;
			padding: 0.7rem 1.5rem;
			border-radius: 30px;
			font-weight: 600;
			cursor: pointer;
			transition: background 0.2s, color 0.2s;
		}
		.toggle-btn.active {
			background: #0d6efd;
			color: #fff;
		}
		.stats-card {
			background: #fff;
			border-radius: 16px;
			box-shadow: 0 4px 24px rgba(0,0,0,0.08);
			padding: 2rem;
			margin-bottom: 2rem;
		}
		.table th, .table td {
			vertical-align: middle;
		}
		.table thead th {
			background: #f1f3f4;
			font-weight: 600;
		}
		.table-hover tbody tr:hover {
			background: #e9ecef;
		}
		@media (max-width: 576px) {
			.stats-card {
				padding: 1rem;
			}
			.toggle-btn {
				padding: 0.5rem 1rem;
				font-size: 0.95rem;
			}
		}
	</style>
	<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.bundle.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
	<script type='text/javascript' src='https://www.google.com/jsapi'></script>
	<script>
		var dateToday = new Date();
		var upto = new Date();
		dateToday.setDate(dateToday.getDate() - 1);
		upto.setFullYear(dateToday.getFullYear() + 1);
		$(function() {
			var from, to;
			from = $("#from").datepicker({
				defaultDate: "+1w",
				changeMonth: true,
				changeYear: true,
				showButtonPanel: true,
				maxDate: dateToday,
				dateFormat: "yy-mm-dd"
			}).on("change", function() {
				to.datepicker("option", "minDate", getDate(this));
			});
			to = $("#to").datepicker({
				defaultDate: "+1w",
				changeMonth: true,
				changeYear: true,
				showButtonPanel: true,
				minDate: dateToday,
				maxDate: upto,
				dateFormat: "yy-mm-dd"
			}).on("change", function() {
				from.datepicker("option", "maxDate", getDate(this));
			});
			function getDate(element) {
				var date;
				try {
					date = $.datepicker.parseDate("yy-mm-dd", element.value);
				} catch (error) {
					date = null;
				}
				return date;
			}
		});
	</script>
{% endblock %}
		<form method="POST" >
			{% csrf_token %}
			<div class="form-group">
				<label for="from">From</label>
				<input type="text" id="from" name="from">
				<label for="to">to</label>
				<input type="text" id="to" name="to">
				<button class="btn btn-warning btn-sm" type="submit" name="Download" value="Download">Download</button>
				<button class="btn btn-info btn-sm" type="submit" name="View" value="View">View</button>
			</div>
	    </form>

	    {% if messages %}
		<ul class="messages">
		    {% for message in messages %}
		    	<div class="alert alert-{{ message.tags }}">
				    <li {% if message.tags %} class="{{ message.tags }}"{% endif %}> {{ message }}
				    </li>

				$('input[type=radio]').change(function() {
					if (this.value == 'NWPM') {
						if(myChart){
							myChart.destroy();
						}
						// Add code to render monthly chart here
					} else if (this.value == 'OWC') {
						if(myChart){
							myChart.destroy();
						}
						// Add code to render overall chart here
					} else if (this.value == 'MOIN') {
						if(myChart){
							myChart.destroy();
						}
						// Add code to render India map here
					}
				});

				// Google GeoChart rendering
				function drawVisualization() {
					var data = new google.visualization.DataTable();
					// Add columns and rows to data as needed
					var opts = {
						region: 'IN',
						domain: 'IN',
						displayMode: 'regions',
						resolution: 'provinces',
						datalessRegionColor: 'transparent',
						colorAxis: {colors: ['#e6e6e6', '#ff8b3e']},
						legend: {position: 'top'}
					};
					var geochart = new google.visualization.GeoChart(document.getElementById('visualization'));
					geochart.draw(data, opts);
				}
				if(google) {
					google.load('visualization', '1.0', {
						packages: ['geochart'],
						callback: function() {
							drawVisualization();
						}
					});
				}
			</script>
			<style>
				#visualization path {
					stroke-width:1;
					stroke:white;
				}
			</style>
			<div id="visualization" style="width: 400px; height: 300px; display: block; margin: 0 auto;"></div>
										{% for workshop in upcoming_workshops %}
											{% if workshop.proposed_workshop_date %}
											<tr>
												<td>{{ workshop.proposed_workshop_coordinator.get_full_name | capfirst }}</td>
												<td>{{ workshop.proposed_workshop_coordinator.profile.institute | capfirst }}</td>
												<td>{{ workshop.proposed_workshop_instructor.get_full_name }}</td>
												<td>{{ workshop.proposed_workshop_title.workshoptype_name }}</td>
												<td>{{ workshop.proposed_workshop_date | date}}</td>
												<td>Coordinator</td>
											</tr>
											{% else %}
											<tr>
												<td>{{ workshop.requested_workshop_coordinator.get_full_name | capfirst }}</td>
												<td>{{ workshop.requested_workshop_coordinator.profile.institute | capfirst }}</td>
												<td>{{ workshop.requested_workshop_instructor.get_full_name }}</td>
												<td>{{ workshop.requested_workshop_title.workshoptype_name }}</td>
												<td>{{ workshop.requested_workshop_date | date}}</td>
												<td>Instructor</td>
											</tr>
											{% endif %}
										{% endfor %}
										</tbody>
									</table>
								</div>
								<!-- Page Navigation -->
								<div class="container">
									<div class="Page-Nav" align="center">
										<nav aria-label="Page navigation">
											<ul class="pagination pagination-sm justify-content-center">
												<li class="page-item">
													{% if upcoming_workshops.has_previous %}
														<a class="page-link" tabindex="-1" href="?page={{ upcoming_workshops.previous_page_number }}">Previous</a>
													{% endif %}
												</li>
												<li class="page-item">
													<span class="current">
														Page {{ upcoming_workshops.number }} of {{ upcoming_workshops.paginator.num_pages }}
													</span>
												</li>
												<li class="page-item">
													{% if upcoming_workshops.has_next %}
														<a class="page-link" href="?page={{ upcoming_workshops.next_page_number }}">Next</a>
													{% endif %}
												</li>
											</ul>
										</nav>
									</div>
								</div>
								<div class="row mt-4">
									<div class="col-md-12">
										<canvas id="myChartPie"></canvas>
										<div id="visualization" style="width: 400px; height: 300px; display: block; margin: 0 auto;"></div>
									</div>
								</div>
								{% else %}
								<div class="jumbotron">
									<h2>Permission to View Upcoming Workshops is set to false, please set it to true in settings.py</h2>
								</div>
								{% endif %}
							</div>
						</div>
					    region: 'IN',
					    domain: 'IN',
					    displayMode: 'regions',
					    resolution: 'provinces',
					    datalessRegionColor: 'transparent',
					    colorAxis: {colors: ['#e6e6e6', '#ff8b3e']},
					    legend: {position: 'top'},
					   	};

					var geochart = new google.visualization.GeoChart(
					document.getElementById('visualization'));
							geochart.draw(data, opts);
					    };	
					if(google) {
					    google.load('visualization', '1.0', {
						packages: ['geochart'],
			            callback: function() {
					    // do stuff, if you wan't - it doesn't matter, because the page isn't blank!
							drawVisualization();
							}
			            })
				        }	
				}
			});
		</script>	
		<style>
		    #visualization path {
		    stroke-width:1; /* control the countries borders width */
		    stroke:white; /* choose a color for the border */
		    }
		</style>
		<div id="visualization" style="width: 400px; height: 300px; display: block; margin: 0 auto;" ></div>

	</div>
</div>
</div>
<br>
{% endblock %}
